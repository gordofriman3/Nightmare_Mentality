<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nightmare Mentality</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Mono&display=swap" rel="stylesheet">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
}

body {
    background: #3D0000;
    color: red;
    font-family: 'Atkinson Hyperlegible Mono', monospace;
    transition: background 0.3s;
}

.hidden {
    display: none !important;
}

.scene {
    width: 100vw;
    height: 100vh;
}

/* MENU */
#menu {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

/* GAME */
#game {
    display: flex;
    flex-direction: column;
}

#stats {
    display: flex;
    justify-content: space-around;
    padding: 10px;
    border: 2px solid red;
    margin: 10px;
    border-radius: 10px;
}

#bottom {
    flex: 1;
    display: flex;
    margin: 10px;
    gap: 10px;
}

#think {
    flex: 1;
    border: 2px solid red;
    border-radius: 10px;
    padding: 10px;
}

#buttons {
    flex: 1;
    border: 2px solid red;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

button {
    background: #3D0000;
    border: 2px solid red;
    color: red;
    padding: 20px 60px;
    font-size: 4vh;
    cursor: pointer;
}

button:active {
    background: red;
    color: black;
}

button:disabled {
    opacity: 0.5;
}

#title {
    color: red;
    text-shadow:
    0 0 5px red,
    0 0 20px red,
    0 0 50px red,
    0 0 100px red,
    0 0 160px darkred;
}
</style>
</head>

<body>

<div id="menu" class="scene">
    <p>Alpha 1.2</p>
    <h1 id="title">Nightmare Mentality</h1>
    <button id="startBtn">Empezar pesadilla</button>
</div>

<div id="game" class="scene hidden">
    <div id="stats">
        <h4 id="health">Salud: 100%</h4>
        <h4 id="anxiety">Ansiedad: 0%</h4>
        <h4 id="energy">EnergÃ­a: 100%</h4>
        <h4 id="distance">Distancia: 0 metros</h4>
    </div>

    <div id="bottom">
        <div id="think">
            <h3>Pensamientos...</h3>
            <p>Tengo que llegar a la escuela, aunque tengo un raro presentimiento,
            como si algo me lo estuviera impidiendo...la escuela queda a 1200 metros desde donde estoy...</p>
        </div>

        <div id="buttons">
            <button id="advancebtn">Avanzar</button>
            <button id="attackbtn" disabled>Atacar</button>
            <button id="restartbtn" disabled>Reiniciar</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    /* ELEMENTOS */
    const startBtn = document.getElementById("startBtn");
    const advanceBtn = document.getElementById("advancebtn");
    const attackBtn = document.getElementById("attackbtn");
    const distanceText = document.getElementById("distance");
    const energyText = document.getElementById("energy");
    const healthText = document.getElementById("health");
    const thinkBox = document.getElementById("think");
    const menuScene = document.getElementById("menu");
    const gameScene = document.getElementById("game");
    const restartBtn = document.getElementById("restartbtn")
    const anxietyText = document.getElementById("anxiety");
    
    /* ESTADO DEL JUEGO */
    let distance = 0;
    let energy = 100;
    let health = 100;
    let enemyAlive = false;
    let enemyHealth = 0;
    let gameActive = true;
    let energyInterval;
    let equippedWeapon = null;
    let advanceCooldown = false;
    let anxiety = 0;
    let anxietyInterval;

    const items = ["BotiquÃ­n ðŸ©¹", "Energizante âš¡", "Cuchillo ðŸ”ª","Clonazepam ðŸ’Š"]

    /* FUNCIONES */
    function getEnemyChance() {
    if (anxiety < 40) return 0.10;
    if (anxiety < 70) return 0.20;
    return 0.30;
}
    function changeScene(id) {
        document.querySelectorAll('.scene').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function updateUI() {
        distanceText.textContent = `Distancia: ${distance} metros`;
        energyText.textContent = `EnergÃ­a: ${energy}%`;
        healthText.textContent = `Salud: ${health}%`;
        anxietyText.textContent = `Ansiedad: ${anxiety}%`;
    }

    function flashBackground(color) {
        const original = document.body.style.background;
        document.body.style.background = color;
        setTimeout(() => document.body.style.background = original, 400);
    }

    function aplicarItem() {
        const item = items[Math.floor(Math.random() * items.length)];

        if (item === "BotiquÃ­n ðŸ©¹") {
            health = Math.min(health + 10, 100);
            thinkBox.innerHTML = "<p>EncontrÃ© un botiquin, por el momento me sirve para resistir un poco mas...</p>";
            flashBackground("#03B500");
        }
        if (item === "Energizante âš¡") {
            energy = Math.min(energy + 100, 100);
            thinkBox.innerHTML = "<p>Una bebida energizante, esto me da un impulso de energia, mi cuerpo puede avanzar con facilidad.</p>";
            flashBackground("#B5B500");
        }

        if (item === "Cuchillo ðŸ”ª") {
            equippedWeapon = "cuchillo";
            thinkBox.innerHTML = "<p>Un cuchillo de cocina... Poco eficiente, sin embargo, esto es mejor que ir indefenso y desarmado.</p>";
            flashBackground("#0036B5");
        }
        if (item === "Clonazepam ðŸ’Š") {
            anxiety = Math.max(anxiety - 30, 0);
            thinkBox.innerHTML = "<p>EncontrÃ© Clonazepam, unas pastillas para la ansiedad, me siento mas relajado momentaneamente.</p>"
            flashBackground("#7F00E0")
        }

        updateUI();
    }

    function startEnergyRecovery() {
        clearInterval(energyInterval);
        energyInterval = setInterval(() => {
            if (!enemyAlive && energy < 100 && gameActive) {
                energy += 1;
                updateUI();
            }
        }, 1000);
    }
    function startAnxietyRecovery() {
        clearInterval(anxietyInterval);
        anxietyInterval = setInterval(() => {
            if (gameActive && anxiety < 100) {
                anxiety += 1;
                updateUI();
            }
        }, 1000);
    }
    function resetGame() {
    // Estado base
    distance = 0;
    energy = 100;
    health = 100;
    enemyAlive = false;
    enemyHealth = 0;
    gameActive = true;
    equippedWeapon = null;
    advanceCooldown = false;
    anxiety = 0;

    updateUI();

    thinkBox.innerHTML = `
        <h3>Pensamientos...</h3>
<p>Tengo que llegar a la escuela, aunque tengo un raro presentimiento,
            como si algo me lo estuviera impidiendo...la escuela queda a 1200 metros desde donde estoy...</p>
        </div>
    `;

    advanceBtn.disabled = false;
    attackBtn.disabled = true;
    restartBtn.disabled = true;

    startEnergyRecovery();
    
    startAnxietyRecovery();
}
    /* EVENTOS */
    restartBtn.addEventListener('click', () => {
    resetGame();
});
    startBtn.addEventListener('click', () => {
        changeScene('game');
        updateUI();
        startEnergyRecovery();
        startAnxietyRecovery();
    });

    advanceBtn.addEventListener('click', () => {
        if (!gameActive || energy <= 0 || enemyAlive) return;

if (advanceCooldown) return;

advanceCooldown = true;
advanceBtn.disabled = true;

setTimeout(() => {
    advanceCooldown = false;
    if (gameActive && !enemyAlive) {
        advanceBtn.disabled = false;
    }
}, 1000);

        if (Math.random() < 0.15) {
            aplicarItem();
            return;
        }

        distance += 15;
        energy -= 10;
        
        const enemyChance = getEnemyChance();
        if (Math.random() < enemyChance) {
            enemyAlive = true;
            enemyHealth = 100;
            attackBtn.disabled = false;
            advanceBtn.disabled = true;
            thinkBox.innerHTML = "<h3>Peligro</h3><p>Â¡Un monstruo me esta atacando! No puedo avanzar hasta detenerlo. (Pulsa Atacar para defenderte)</p>";
        } else {
            thinkBox.innerHTML = "<p>Sigo avanzando entre la oscuridad y la soledad...</p>";
        }

        updateUI();
    });

    attackBtn.addEventListener('click', () => {
        if (!gameActive) return;

        enemyHealth -= equippedWeapon ? 20 : 10;
        health -= 5;

        if (enemyHealth <= 0) {
            enemyAlive = false;
            attackBtn.disabled = true;
            advanceBtn.disabled = false;
            thinkBox.innerHTML = "<p>El monstruo ya no se mueve, estoy algo herido, pero puedo seguir.</p>";
        }

        if (health <= 0) {
            gameActive = false;
            thinkBox.innerHTML = `<p>Â¡Agh! No puedo respirar... (Distancia recorrida en total: ${distance} metros)</p>`;
            advanceBtn.disabled = true;
            attackBtn.disabled = true;
            restartBtn.disabled = false;
            clearInterval(energyInterval);
        }

        updateUI();
    });

});
</script>
</body>
</html>
