 <!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nightmare Mentality</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Mono&display=swap" rel="stylesheet">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
}

body {
    background: #3D0000;
    color: red; 
    font-family: 'Atkinson Hyperlegible Mono', monospace;
    transition: background 0.3s;
}

.hidden {
    display: none !important;
}

.scene {
    width: 100vw;
    min-height: 100vh;
}

/* MENU */
#menu {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
}

/* GAME */
#game {
    display: flex;
    flex-direction: column;
}

#stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    padding: 5px;
    border: 2px solid red;
    border-radius: 10px;
    box-shadow: 0 0 10px red;
}

#bottom {
    flex: 1;
    display: flex;
    margin: 10px;
    gap: 10px;
}

#think {
    flex: 1;
    border: 2px solid red;
    border-radius: 10px;
    padding: 10px;
    box-shadow: 0 0 10px red;
}

#buttons {
    flex: 1;
    border: 2px solid red;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 20px;
    box-shadow: 0 0 10px red;
}

button {
    background: #3D0000;
    border: 2px solid red;
    color: red;
    padding: 20px 60px;
    font-size: 4vh;
    cursor: pointer;
    border-radius: 10px;
    box-shadow: 0px 0px 25px rgba(255, 0, 0, 0.5);
}

button:active {
    background: red;
    color: black;
}

button:disabled {
    opacity: 0.5;
}

#title {
    color: red;
    text-shadow:
    0 0 5px red,
    0 0 20px red,
    0 0 50px red,
    0 0 100px red,
    0 0 160px darkred;
    animation: glitch 0.2s infinite;
}
@keyframes glitch {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px)}
  40% { transform: translate(2px, -2px); }
  60% { transform: translate(-1px, 1px); }
  80% { transform: translate(1px, -1px); }
  100% { transform: translate(0, 0); }
}
@keyframes shake {
  0% { transform: translate(0, 0); }
  25% { transform: translate(-2px, 1px); }
  50% { transform: translate(2px, -1px); }
  75% { transform: translate(-1px, -2px); }
  100% { transform: translate(0); }
}

.low-health {
  animation: shake 0.2s infinite;
}
#decision {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    gap: 25px;
}
#jumpframe {
    position: fixed;
    top: 0;
    left: 0;
    
    width: 100vw;
    height: 100vh;

    object-fit: cover;
    
    z-index: 9999;
}
.stat {
    display: flex;
    align-items: center;
    gap: 6px;
}
.bar {
    width: 100%;
    height: 14px;
    background: #3D0000;
    border: 2px solid red;
    border-radius: 6px;
    overflow: hidden;
}
.bar div {
    height: 100%;
    width: 100%;
    background: red;
    transition: width 0.3s;
}
#healthbar {
    background: darkred;
}
#anxietybar {
    background: darkmagenta;
}
#energybar {
    background: #C4B000;
}
</style>
</head>

<body>

<div id="menu" class="scene">
    <p>Alpha 2.2.1</p>
    <h1 id="title">Nightmare Mentality</h1>
    <button id="startBtn">Empezar pesadilla</button>
    <button id="helpBtn">Ayuda</button>
</div>

<div id="game" class="scene hidden">
    <div id="stats">

        <div class="stat">
        <span id="health">Salud</span>
        <div class="bar">
            <div class="bar-fill" id="healthbar"></div>
        </div>
        </div>

        <div class="stat">
        <span id="anxiety">Ansiedad</span>
        <div class="bar">
            <div class="bar-fill" id="anxietybar"></div>
        </div>
        </div>

        <div class="stat">
        <span id="energy">Energía</span>
        <div class="bar">
            <div class="bar-fill" id="energybar"></div>
            </div>
        </div>

        <div id="stat">
        <h4 id="distance">Distancia: 0 metros</h4>
        </div>
    </div>

    <div id="bottom">
        <div id="think">
            <h3>Pensamientos...</h3>
            <p>Tengo que llegar a la escuela, aunque tengo un raro presentimiento,
            como si algo me lo estuviera impidiendo...la escuela queda a 1200 metros desde donde estoy...</p>
        </div>

        <div id="buttons">
            <button id="advancebtn">Avanzar</button>
            <button id="attackbtn" disabled>Atacar</button>
            <button id="restartbtn" disabled>Reiniciar</button>
        </div>
    </div>
</div>
<div id="help" class="scene hidden">
    <button id="backBtn">Volver</button>
    <center><h1>Bienvenido a Nightmare Mentality</h1></center>
    <strong>Objetivo:</strong>
    <p>LLEGAR A LA ESCUELA CON VIDA.</p>
    <strong>Defensa:</strong>
    <p>Aca las armas son estrictamente limitadas, procura usarlas cuando no tengas escapatoria.</p>
    <strong>Salud:</strong>
    <p>No solamente hay que cuidarse y no recibir daño, si no que tambien hay que mantener nuestra energia
        estable, consumiendo grandes cantidades de azucar y cafeina. ademas tambien hay que tener en cuenta la salud mental, MUY IMPORTANTE.
    </p>
    <a href="https://www.tiktok.com/@el.gordo.friman?_r=1&_t=ZM-9359Tzuvyoe">Presioná acá para apoyar el juego :)</a>
</div>
<div id="decision" class="scene hidden">
<h3 id="decisionMessage"></h3>
<button id="takeBtn">Tomar</button>
<button id="leaveBtn">Dejar</button>
</div>
<audio id="punch" src="assets/sounds/punch.mp3"></audio>
<audio id="knife" src="assets/sounds/knife.mp3"></audio>
<audio id="makarov" src="assets/sounds/pistolshot.mp3"></audio>
<audio id="sawedoff" src="assets/sounds/sawedoffshot.mp3"></audio>
<audio id="bandageput" src="assets/sounds/bandageput.mp3"></audio>
<audio id="takegun" src="assets/sounds/takegun.mp3"></audio>
<audio id="pills" src="assets/sounds/pills.mp3"></audio>
<audio id="opencan" src="assets/sounds/monstercan.mp3"></audio>
<audio id="medkit" src="assets/sounds/medkitexhale.mp3"></audio>

<img id="jumpframe" src="assets/images/jumpscare.jpg" class="hidden">
<img id="bandage" src="assets/images/bandage.png" class="hidden">
<img id="clonazepampills" src="assets/images/clonazepam.png" class="hidden">
<img id="knifepng" src="assets/images/knife.png" class="hidden">
<img id="medkitpng" src="assets/images/medkit.png" class="hidden">
<img id="monster" src="assets/images/monster.png" class="hidden">
<script>
document.addEventListener('DOMContentLoaded', () => {
    console.log("JS CARGADO");

    /* ELEMENTOS */
    const healthBar = document.getElementById("healthbar");
    const energyBar = document.getElementById("energybar");
    const anxietyBar = document.getElementById("anxietybar")
    const startBtn = document.getElementById("startBtn");
    const advanceBtn = document.getElementById("advancebtn");
    const attackBtn = document.getElementById("attackbtn");
    const distanceText = document.getElementById("distance");
    const energyText = document.getElementById("energy");
    const healthText = document.getElementById("health");
    const thinkBox = document.getElementById("think");
    const menuScene = document.getElementById("menu");
    const gameScene = document.getElementById("game");
    const restartBtn = document.getElementById("restartbtn")
    const anxietyText = document.getElementById("anxiety");
    const helpBtn = document.getElementById("helpBtn");
    const backBtn = document.getElementById("backBtn");
    const leaveBtn = document.getElementById("leaveBtn");
    const takeBtn = document.getElementById("takeBtn")
    const sounds = {
        "Clonazepam": document.getElementById("pills"),
        "Vendaje": document.getElementById("bandageput"),
        "Botiquin": document.getElementById("medkit"),
        "Monster Energy": document.getElementById("opencan"),
        "Cuchillo": document.getElementById("knife"),
        "Makarov PM": document.getElementById("makarov"),
        "Escopeta recortada": document.getElementById("sawedoff"),
        punch: document.getElementById("punch"),
        takeWeapon: document.getElementById("takegun")
    }
    const jumpframeImg = document.getElementById("jumpframe");
    
    /* ESTADO DEL JUEGO */
    let distance = 0;
    let energy = 100;
    let health = 100;
    let enemyAlive = false;
    let enemyHealth = 0;
    let gameActive = true;
    let energyInterval;
    let equippedWeapon = null;
    let advanceCooldown = false;
    let anxiety = 0;
    let anxietyInterval;
    let currentEnemy = null;
    let pendingItem = null;
    let canAttack = true;
    let attackCooldownTimeout = null;

    const weapons = [
        { name: "Cuchillo", damage: 20, cooldown: 600 },
        { name: "Makarov PM", damage: 25, cooldown: 400, ammo: 8 },
        { name: "Escopeta recortada", damage: 50, cooldown: 1000, ammo: 2 },
     ];
    const items = ["Vendaje", "Monster Energy", "Clonazepam", "Botiquin"]
    
    const enemies = [
        {
        name: "La sombra",
        hp: 100,
        damage: 5,
        minDist: 0,
        maxDist: 1200,
        attackChance: 1
        },
        {
        name: "El bloqueador",
        hp: 125,
        damage: 7,
        minDist: 400,
        maxDist: 1200,
        attackChance: 1
        },
        {
        name: "El acechante",
        hp: 150,
        damage: 10,
        minDist: 800,
        maxDist: 1200,
        attackChance: 0.5
        }
        ];

    /* FUNCIONES */
    function playItemSound(itemName) {
    const sound = sounds[itemName];
    if (!sound) return;

    sound.currentTime = 0;
    sound.play();
}
    function jumpframe() {
        if (anxiety < 70) return;

        if (Math.random() < 0.15) {
            jumpframeImg.classList.remove("hidden");

            setTimeout(() => {
                jumpframeImg.classList.add("hidden");
            }, 80);
        }
    }
    function playAttackSound() {
        let sound;

        if (equippedWeapon) {
            sound = sounds[equippedWeapon.name];
        } else {
            sound = sounds.punch;
        }
        if (!sound) return;

        sound.currentTime = 0;
        sound.play();
    }
    function startAttackCooldown(time) {
    canAttack = false;
    attackBtn.disabled = true;

    clearTimeout(attackCooldownTimeout);
    attackCooldownTimeout = setTimeout(() => {
        if (enemyAlive && gameActive) {
            canAttack = true;
            attackBtn.disabled = false;
        }
    }, time);
}
    function getEnemyByDistance(distance) {
  const posibles = enemies.filter(e =>
    distance >= e.minDist && distance <= e.maxDist
  );

  if (posibles.length === 0) return null;

  return posibles[Math.floor(Math.random() * posibles.length)];
}
    function getEnemyChance() {
    if (anxiety < 40) return 0.10;
    if (anxiety < 70) return 0.20;
    return 0.30;
}
    function changeScene(id) {
        document.querySelectorAll('.scene').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function updateUI() {
        distanceText.textContent = `Distancia: ${distance} metros`;

        energyText.textContent = `Energía`;
        healthText.textContent = `Salud`;
        anxietyText.textContent = `Ansiedad`;

        healthBar.style.width = health + "%";
        anxietyBar.style.width = anxiety + "%";
        energyBar.style.width = energy + "%";

            if (health <= 20 && gameActive) {
    document.body.classList.add("low-health");
} else {
    document.body.classList.remove("low-health");
}
}
    function flashBackground(color) {
        const original = document.body.style.background;
        document.body.style.background = color;
        setTimeout(() => document.body.style.background = original, 400);
    }
    function encontrarObjeto() {
        const isWeapon = Math.random() < 0.25
        if (isWeapon) {
            pendingItem = {
                type: "weapon",
                data: weapons[Math.floor(Math.random() * weapons.length)]
            };
            } else {
                pendingItem = {
                    type: "item",
                    data: items[Math.floor(Math.random() * items.length)]
                };
            }
            abrirDecision();
            }

            function aplicarPendingItem() {
        if (!pendingItem) return;

        if (pendingItem.type === "weapon") {
            equippedWeapon = { ...pendingItem.data};

            thinkBox.innerHTML = `<p>Ahora tengo ${equippedWeapon.name}.</p>`;

            playItemSound("takeWeapon");
            flashBackground("#0036B5");
        } 
            if (pendingItem.type === "item") {
                const item = pendingItem.data;

        if (item === "Botiquin") {
            health = Math.min(health + 30, 100);
            thinkBox.innerHTML = "<p>Encontre un botiquin, recupere mi salud como se debe, que alivio.</p>"
            flashBackground("#03B500");
            playItemSound("Botiquin");
        } 
        if (item === "Vendaje") {
            health = Math.min(health + 10, 100);
            thinkBox.innerHTML = "<p>Encontré un vendaje, por el momento me sirve para resistir un poco el dolor...</p>";
            flashBackground("#649412");
            playItemSound("Vendaje");
        }
        if (item === "Monster Energy") {
            energy = Math.min(energy + 100, 100);
            thinkBox.innerHTML = "<p>Una Monster, esto me da un impulso de energia, mi cuerpo puede avanzar con facilidad.</p>";
            flashBackground("#B5B500");
            playItemSound("Monster Energy");
        }
        if (item === "Clonazepam") {
            anxiety = Math.max(anxiety - 30, 0);
            thinkBox.innerHTML = "<p>Encontré Clonazepam, unas pastillas para la ansiedad, me siento mas relajado momentaneamente.</p>"
            flashBackground("#7F00E0");
            playItemSound("Clonazepam")
        }
        }
        updateUI();
    }
    function abrirDecision() {
        const decisionMsg =
        document.getElementById("decisionMessage")

        decisionMsg.textContent = `¿Tomar ${pendingItem.data.name || pendingItem.data}?`;

        changeScene("decision")
    }
    function startEnergyRecovery() {
        clearInterval(energyInterval);
        energyInterval = setInterval(() => {
            if (!enemyAlive && energy < 100 && gameActive) {
                energy += 1;
                updateUI();
            }
        }, 600);
    }
    function startAnxietyRecovery() {
        clearInterval(anxietyInterval);
        anxietyInterval = setInterval(() => {
            if (gameActive && anxiety < 100) {
                anxiety += 1;
                updateUI();
            }
        }, 1000);
    }
    function resetGame() {
    // Estado base
    distance = 0;
    energy = 100;
    health = 100;
    enemyAlive = false;
    enemyHealth = 0;
    gameActive = true;
    equippedWeapon = null;
    advanceCooldown = false;
    anxiety = 0;

    updateUI();

    thinkBox.innerHTML = `
        <h3>Pensamientos...</h3>
<p>Tengo que llegar a la escuela, aunque tengo un raro presentimiento,
            como si algo me lo estuviera impidiendo...la escuela queda a 1200 metros desde donde estoy...</p>`;

    advanceBtn.disabled = false;
    attackBtn.disabled = true;
    restartBtn.disabled = true;

    startEnergyRecovery();
    
    startAnxietyRecovery();
}
    /* EVENTOS */
    leaveBtn.addEventListener("click", () => {
        thinkBox.innerHTML = `<p>Decidio no tomar ${pendingItem.data.name || pendingItem.data}.</p>`;
        pendingItem = null;
        changeScene("game")
    });
    takeBtn.addEventListener("click", () => {
        aplicarPendingItem();
        pendingItem = null;
        changeScene("game")
    });
    restartBtn.addEventListener('click', () => {
    resetGame();
    canAttack = true;
    clearTimeout(attackCooldownTimeout);
});
helpBtn.addEventListener('click', () => {
    changeScene('help');
    updateUI();
});
backBtn.addEventListener('click', () => {
    changeScene('menu');
    updateUI();
})
    startBtn.addEventListener('click', () => {
        changeScene('game');
        updateUI();
        startEnergyRecovery();
        startAnxietyRecovery();
    });

    advanceBtn.addEventListener('click', () => {
    if (!gameActive || energy <= 0 || enemyAlive) return;
    if (advanceCooldown) return;

    advanceCooldown = true;
    advanceBtn.disabled = true;

    setTimeout(() => {
        advanceCooldown = false;
        if (gameActive && !enemyAlive) {
            advanceBtn.disabled = false;
        }
    }, 1000);

    const ITEM_CHANCE = 0.30;

    if (Math.random() < ITEM_CHANCE) {
        encontrarObjeto();
        return;
    }

    distance += 15;
    energy -= 10;

    jumpframe();

    const enemy = getEnemyByDistance(distance);
    const enemyChance = getEnemyChance();

    if (enemy && Math.random() < enemyChance && Math.random() < enemy.attackChance) {
        enemyAlive = true;
        enemyHealth = enemy.hp;
        currentEnemy = enemy;

        canAttack = true;
        attackBtn.disabled = false;
        advanceBtn.disabled = true;

        thinkBox.innerHTML = `
            <h3>Peligro</h3>
            <p>
${enemy.name} aparece frente a mí… no puedo avanzar (Pulsa atacar para defenderte)
${equippedWeapon && equippedWeapon.ammo !== undefined 
    ? `<br>Munición: ${equippedWeapon.ammo}` 
    : ""}
</p>
        `;
    } else {
        thinkBox.innerHTML = "<p>Sigo avanzando entre la oscuridad y la soledad...</p>";
    }

    updateUI();
});

    attackBtn.addEventListener('click', () => {
    if (!gameActive || !canAttack) return;

    playAttackSound();

    const weapon = equippedWeapon;
    const playerDamage = weapon ? weapon.damage : 10;
    const cooldown = weapon ? weapon.cooldown : 500;

    enemyHealth -= playerDamage;
    health -= currentEnemy.damage;

    if (equippedWeapon && equippedWeapon.ammo !== undefined) {
        equippedWeapon.ammo--;

        if (equippedWeapon.ammo > 0) {
            thinkBox.innerHTML = `<p>${currentEnemy.name} aparece frente a mí… no puedo avanzar, ataco con mi ${equippedWeapon.name}.<br>
Munición restante: ${equippedWeapon.ammo}</p>`;
        } else {
            thinkBox.innerHTML = `
                <p>
Mi ${equippedWeapon.name} se quedó sin munición,
lo voy a tener que abandonar.
                </p>
            `;
            equippedWeapon = null;
        }
    }

    startAttackCooldown(cooldown);

    if (enemyHealth <= 0) {
        enemyAlive = false;
        attackBtn.disabled = true;
        advanceBtn.disabled = false;
        thinkBox.innerHTML = "<p>El monstruo ya no se mueve, estoy algo herido, pero puedo seguir.</p>";
    }

    if (health <= 0) {
        gameActive = false;
        thinkBox.innerHTML = `<p>¡Agh! No puedo respirar... (Distancia recorrida: ${distance} metros)</p>`;
        advanceBtn.disabled = true;
        attackBtn.disabled = true;
        restartBtn.disabled = false;
        clearInterval(energyInterval);
    }

    updateUI();
});

});
</script>
</body>
</html>
